---
  - name: create NFS
    gather_facts: false
    hosts: all
    become: true
    become_method: sudo
    tasks:
      - name: install nfs
        apt:
          name: nfs-kernel-server
          state: present
      - name: enable firewall
        ufw:
          state: enabled
      - name: permit tcp nfs
        shell: ufw allow 22,2049,111,20048/tcp
      - name: permit udp nfs
        shell: ufw allow 2049,111,20048/tcp
      - name: dir for nfs
        file:
          path: /srv/share/upload
          state: directory
          owner: nobody
          group: nogroup
          mode: 0777
      - name: create structure
        shell: echo '/srv/share *(rw,sync,root_squash)' >> /etc/exports
      - name: enable exports
        shell: exportfs -r
      - name: check exports
        shell: exportfs -s
        register: output
      - name: show exports
        debug: msg={{ output.stdout_lines }}